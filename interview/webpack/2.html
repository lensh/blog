<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>高级概念 | 洛清寒前端进阶</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.bb0d65c1.css" as="style"><link rel="preload" href="/blog/assets/js/app.bce4cc53.js" as="script"><link rel="preload" href="/blog/assets/js/2.a9ec72d1.js" as="script"><link rel="preload" href="/blog/assets/js/86.a94b2c44.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.77389835.js"><link rel="prefetch" href="/blog/assets/js/11.9a95e166.js"><link rel="prefetch" href="/blog/assets/js/12.1659776e.js"><link rel="prefetch" href="/blog/assets/js/13.9d80e6cc.js"><link rel="prefetch" href="/blog/assets/js/14.748c57c3.js"><link rel="prefetch" href="/blog/assets/js/15.02b2a8b6.js"><link rel="prefetch" href="/blog/assets/js/16.92afd781.js"><link rel="prefetch" href="/blog/assets/js/17.50cf4b4b.js"><link rel="prefetch" href="/blog/assets/js/18.0353da46.js"><link rel="prefetch" href="/blog/assets/js/19.99e2bd93.js"><link rel="prefetch" href="/blog/assets/js/20.1c2aa482.js"><link rel="prefetch" href="/blog/assets/js/21.4cfc1294.js"><link rel="prefetch" href="/blog/assets/js/22.cf02801b.js"><link rel="prefetch" href="/blog/assets/js/23.9e4b6a4c.js"><link rel="prefetch" href="/blog/assets/js/24.bf9e7505.js"><link rel="prefetch" href="/blog/assets/js/25.a3c92d65.js"><link rel="prefetch" href="/blog/assets/js/26.6e9ded48.js"><link rel="prefetch" href="/blog/assets/js/27.2ba6ef15.js"><link rel="prefetch" href="/blog/assets/js/28.b65a33fd.js"><link rel="prefetch" href="/blog/assets/js/29.19e92d5e.js"><link rel="prefetch" href="/blog/assets/js/3.c5f6830c.js"><link rel="prefetch" href="/blog/assets/js/30.15e8fa30.js"><link rel="prefetch" href="/blog/assets/js/31.ece7757e.js"><link rel="prefetch" href="/blog/assets/js/32.4b88c1aa.js"><link rel="prefetch" href="/blog/assets/js/33.d29be3fc.js"><link rel="prefetch" href="/blog/assets/js/34.19d2310f.js"><link rel="prefetch" href="/blog/assets/js/35.8ab59007.js"><link rel="prefetch" href="/blog/assets/js/36.255e49ff.js"><link rel="prefetch" href="/blog/assets/js/37.e0a72ee4.js"><link rel="prefetch" href="/blog/assets/js/38.e688dc00.js"><link rel="prefetch" href="/blog/assets/js/39.b44fca8d.js"><link rel="prefetch" href="/blog/assets/js/4.13e4e37b.js"><link rel="prefetch" href="/blog/assets/js/40.be5a353a.js"><link rel="prefetch" href="/blog/assets/js/41.e06f2ea7.js"><link rel="prefetch" href="/blog/assets/js/42.02e90f71.js"><link rel="prefetch" href="/blog/assets/js/43.5f255755.js"><link rel="prefetch" href="/blog/assets/js/44.4d178b89.js"><link rel="prefetch" href="/blog/assets/js/45.33d20725.js"><link rel="prefetch" href="/blog/assets/js/46.bf0d61aa.js"><link rel="prefetch" href="/blog/assets/js/47.4ee2900b.js"><link rel="prefetch" href="/blog/assets/js/48.7b0ca394.js"><link rel="prefetch" href="/blog/assets/js/49.393b42e8.js"><link rel="prefetch" href="/blog/assets/js/5.a81b0ad3.js"><link rel="prefetch" href="/blog/assets/js/50.eec45d2a.js"><link rel="prefetch" href="/blog/assets/js/51.672cdd65.js"><link rel="prefetch" href="/blog/assets/js/52.c668f264.js"><link rel="prefetch" href="/blog/assets/js/53.9c3afa39.js"><link rel="prefetch" href="/blog/assets/js/54.f5e4cffd.js"><link rel="prefetch" href="/blog/assets/js/55.d6f1e33e.js"><link rel="prefetch" href="/blog/assets/js/56.cac2a9dc.js"><link rel="prefetch" href="/blog/assets/js/57.8f9f0b2f.js"><link rel="prefetch" href="/blog/assets/js/58.030835fc.js"><link rel="prefetch" href="/blog/assets/js/59.0a2a5a1c.js"><link rel="prefetch" href="/blog/assets/js/6.bd3c8686.js"><link rel="prefetch" href="/blog/assets/js/60.9d2a6a2c.js"><link rel="prefetch" href="/blog/assets/js/61.ebe4164f.js"><link rel="prefetch" href="/blog/assets/js/62.f034db14.js"><link rel="prefetch" href="/blog/assets/js/63.02a05925.js"><link rel="prefetch" href="/blog/assets/js/64.75e0c7bc.js"><link rel="prefetch" href="/blog/assets/js/65.d85a9c63.js"><link rel="prefetch" href="/blog/assets/js/66.9d3c2882.js"><link rel="prefetch" href="/blog/assets/js/67.a8046c7a.js"><link rel="prefetch" href="/blog/assets/js/68.f5ad04b8.js"><link rel="prefetch" href="/blog/assets/js/69.a85b6c33.js"><link rel="prefetch" href="/blog/assets/js/7.58c1cb6b.js"><link rel="prefetch" href="/blog/assets/js/70.6a1d5e38.js"><link rel="prefetch" href="/blog/assets/js/71.6d1196e3.js"><link rel="prefetch" href="/blog/assets/js/72.557d8918.js"><link rel="prefetch" href="/blog/assets/js/73.cc1a9caf.js"><link rel="prefetch" href="/blog/assets/js/74.d4b213d6.js"><link rel="prefetch" href="/blog/assets/js/75.28ccefa2.js"><link rel="prefetch" href="/blog/assets/js/76.018b175c.js"><link rel="prefetch" href="/blog/assets/js/77.a586a573.js"><link rel="prefetch" href="/blog/assets/js/78.a375a0f4.js"><link rel="prefetch" href="/blog/assets/js/79.bbb3d3c9.js"><link rel="prefetch" href="/blog/assets/js/8.67965e6b.js"><link rel="prefetch" href="/blog/assets/js/80.6bba3aa6.js"><link rel="prefetch" href="/blog/assets/js/81.6cf60b0f.js"><link rel="prefetch" href="/blog/assets/js/82.f9446314.js"><link rel="prefetch" href="/blog/assets/js/83.b8536723.js"><link rel="prefetch" href="/blog/assets/js/84.f5714a27.js"><link rel="prefetch" href="/blog/assets/js/85.ecd19d8f.js"><link rel="prefetch" href="/blog/assets/js/87.f7e56850.js"><link rel="prefetch" href="/blog/assets/js/88.1b407358.js"><link rel="prefetch" href="/blog/assets/js/89.1d5ea70a.js"><link rel="prefetch" href="/blog/assets/js/9.743d0d51.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.bb0d65c1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/images/blog.jpg" alt="洛清寒前端进阶" class="logo"> <span class="site-name can-hide">洛清寒前端进阶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/blog/" class="nav-link">
  进阶博文
</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link router-link-active">
  笔试面试
</a></div><div class="nav-item"><a href="https://juejin.im/post/5dfef50751882512444027eb" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大厂面经
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/lensh/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><span class="title">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lensh/vue-qq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue-qq
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/lensh/mini-promise" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mini-promise
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/lensh/React-SSR" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-ssr
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/blog/" class="nav-link">
  进阶博文
</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link router-link-active">
  笔试面试
</a></div><div class="nav-item"><a href="https://juejin.im/post/5dfef50751882512444027eb" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大厂面经
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/lensh/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><span class="title">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lensh/vue-qq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue-qq
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/lensh/mini-promise" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mini-promise
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/lensh/React-SSR" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-ssr
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/css/1.html" class="sidebar-heading clickable"><span>css</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/es6/1.html" class="sidebar-heading clickable"><span>es6</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/html/1.html" class="sidebar-heading clickable"><span>html</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/js/1.html" class="sidebar-heading clickable"><span>js</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/node/node.html" class="sidebar-heading clickable"><span>node</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/react/react.html" class="sidebar-heading clickable"><span>react</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/vue/vue.html" class="sidebar-heading clickable"><span>vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/webpack/1.html" class="sidebar-heading clickable open"><span>webpack</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/interview/webpack/1.html" class="sidebar-link">核心概念</a></li><li><a href="/blog/interview/webpack/2.html" class="active sidebar-link">高级概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#一、tree-shaking" class="sidebar-link">一、Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#二、区分开发环境和生成环境的打包方式" class="sidebar-link">二、区分开发环境和生成环境的打包方式</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#三、code-splitting" class="sidebar-link">三、Code Splitting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#优化方式" class="sidebar-link">优化方式</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#更多配置参数" class="sidebar-link">更多配置参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#四、lazy-loading-懒加载，chunk是什么" class="sidebar-link">四、Lazy Loading 懒加载，chunk是什么</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#五、打包分析、preloading、prefetching" class="sidebar-link">五、打包分析、preloading、prefetching</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#_1、打包分析" class="sidebar-link">1、打包分析</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#_2、preloading（不太适用）、prefetching-使用场景" class="sidebar-link">2、preloading（不太适用）、prefetching 使用场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#六、css文件代码分割" class="sidebar-link">六、CSS文件代码分割</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#七、webpack与浏览器缓存" class="sidebar-link">七、webpack与浏览器缓存</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#八、shimming-的作用" class="sidebar-link">八、Shimming 的作用</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#九、环境变量的使用" class="sidebar-link">九、环境变量的使用</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#十、library的打包" class="sidebar-link">十、Library的打包</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#十一、pwa的打包" class="sidebar-link">十一、PWA的打包</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#十二、typescript-的打包配置" class="sidebar-link">十二、TypeScript 的打包配置</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#十三、使用-webpackdevserver-实现请求转发" class="sidebar-link">十三、使用 WebpackDevServer 实现请求转发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#_1、路径替换" class="sidebar-link">1、路径替换</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#_2、路径重写" class="sidebar-link">2、路径重写</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#_3、支持https的转发" class="sidebar-link">3、支持https的转发</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#_4、支持转发跨域的请求" class="sidebar-link">4、支持转发跨域的请求</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#十四、使用webpackdevserver解决单页面应用路由问题" class="sidebar-link">十四、使用WebpackDevServer解决单页面应用路由问题</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#十五、eslint-在-webpack-中的配置" class="sidebar-link">十五、EsLint 在 Webpack 中的配置</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#十六、webpack性能优化" class="sidebar-link">十六、webpack性能优化</a></li><li class="sidebar-sub-header"><a href="/blog/interview/webpack/2.html#十七、多页面打包配置" class="sidebar-link">十七、多页面打包配置</a></li></ul></li><li><a href="/blog/interview/webpack/3.html" class="sidebar-link">底层原理</a></li><li><a href="/blog/interview/webpack/4.html" class="sidebar-link">性能优化</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/browser/1.html" class="sidebar-heading clickable"><span>浏览器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/coding/1.html" class="sidebar-heading clickable"><span>编程题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/network/1.html" class="sidebar-heading clickable"><span>网络和网络安全</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/practice-mode/1.html" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/suanfa/suanfa.html" class="sidebar-heading clickable"><span>算法和数据结构</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="高级概念"><a href="#高级概念" class="header-anchor">#</a> 高级概念</h1> <h2 id="一、tree-shaking"><a href="#一、tree-shaking" class="header-anchor">#</a> 一、Tree Shaking</h2> <ul><li>作用：打包的时候把一个模块里面没有用到的东西全部移除掉。</li> <li>注意：Tree Shaking只支持ES Module的引用方式，因为Tree Shaking只支持静态引入。ES Module属于静态引入，而CommonJS属于动态引入。</li></ul> <p>先来看一个例子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// math.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">minus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>打包的时候会发现，虽然index.js只引入了add方法，但是打包后的bunlde.js把minus方法也包含在里面了，这样会使bunlde.js的体积变大，怎么优化？就是利用Tree Shaking，把没有使用到的方法或者模块全部剔除掉，不打包。</p> <p>webpack配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token operator">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token comment">//tree shaking 配置,开发模式下需要配置，生产模式不需要，默认会tree shaking</span>
optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    usedExports<span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// 只使用导出的模块</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>sideEffects选项</li></ul> <p>如果不需要对某个模块作tree shaking，则需要在package.json作配置，例如下面的@babel/polyfill和index.css，由于没有导出任何东西，那么设置了tree Shaking的情况下，就会被tree Shaking剔除掉，这不是我们希望的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'@babel/polyfill'</span><span class="token punctuation">;</span>  <span class="token comment">// 默认会被tree Shaking</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>  <span class="token comment">// 默认会被tree Shaking</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>
</code></pre></div><p>修改package.json:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json部分配置</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;learn-webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>   <span class="token comment">// 写入不需要被tree Shaking的模块，开发和生成都需要配置</span>
      <span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;*.css&quot;</span>  <span class="token comment">// 所有css保留，不作tree Shaking</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样配置，就可以了。如果没有不需要被tree Shaking的模块，则把&quot;sideEffects&quot;设置为false即可。</p> <ul><li>注意：在development开发模式下，打包后的代码只会标记没有使用到的模块，并不会移除掉没有使用的方法或者模块，因为开发环境是需要调试的，移除的话不利于调试。只有在production模式下才会被真正移除。 另外生产模式默认会tree shaking，不需要做webpack.config.js中的optimization配置，package.json按照需要填写&quot;sideEffects&quot;即可。</li></ul> <h2 id="二、区分开发环境和生成环境的打包方式"><a href="#二、区分开发环境和生成环境的打包方式" class="header-anchor">#</a> 二、区分开发环境和生成环境的打包方式</h2> <p>开发环境和生产环境的打包区别：</p> <ul><li>sourceMap</li> <li>压缩代码</li></ul> <p>把开发模式和生产模式公用的配置写在一个文件里，然后利用webpack-merge模块实现合并配置。</p> <p>安装webpack-merge</p> <div class="language-js extra-class"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> webpack<span class="token operator">-</span>merge
</code></pre></div><p>webpack配置如下：</p> <ul><li>webpack.common.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//entry: './src/index.js', // 入口文件，等价于下面的main</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> <span class="token comment">// 第一个入口文件</span>
        sub<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> <span class="token comment">// 第二个入口文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 打包出口</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//publicPath: '/', // webpackDevServer要配置这个</span>
        <span class="token comment">// publicPath: 'http://cdn.com/',  // 在打包后生成的js地址前面加上域名，即http://cdn.com/main.js</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span> <span class="token comment">// 打包后的文件的名字,[name]是占位符，是上面的entry里的main或者sub</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span> <span class="token comment">// 打包后的目录,必须使用绝对路径,要用到path.resolve</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 配置相关loader</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|jpeg)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// loader: 'file-loader',  // 使用 file-loader 打包</span>
                    <span class="token comment">// options: {</span>
                    <span class="token comment">//     name: '[name].[ext]',// 配置打包后图片的名字,[name]就是图片的原名字,[ext]是原后缀</span>
                    <span class="token comment">//     outputPath: 'images/',  // 将打包后的图片放在images目录下，不配置则会放在根目录下</span>
                    <span class="token comment">// }</span>
                    loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span> <span class="token comment">// 使用 url-loader 打包，在文件大小（单位 byte）低于指定的限制时，可以返回一个 DataURL。</span>
                    options<span class="token operator">:</span> <span class="token punctuation">{</span>
                        name<span class="token operator">:</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span><span class="token comment">// 配置打包后图片的名字,[name]就是图片的原名字,[ext]是原后缀</span>
                        outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>  <span class="token comment">// 将打包后的图片放在images目录下，不配置则会放在根目录下</span>
                        limit<span class="token operator">:</span> <span class="token number">2048</span>  <span class="token comment">// 图片小于2048字节就会打包成base64</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(css|scss)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                        options<span class="token operator">:</span> <span class="token punctuation">{</span>
                            importLoaders<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                            modules<span class="token operator">:</span> <span class="token boolean">true</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(eot|ttf|svg)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">{</span>
                    loader<span class="token operator">:</span> <span class="token string">'file-loader'</span>  <span class="token comment">// 使用 file-loader 打包</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 开发业务代码时的写法</span>
                   <span class="token comment">//presets: [&quot;@babel/preset-env&quot;]</span>
                   presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                       targets<span class="token operator">:</span> <span class="token punctuation">{</span>
                           edge<span class="token operator">:</span> <span class="token string">&quot;17&quot;</span><span class="token punctuation">,</span>
                           firefox<span class="token operator">:</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">,</span>
                           chrome<span class="token operator">:</span> <span class="token string">&quot;67&quot;</span><span class="token punctuation">,</span>
                           safari<span class="token operator">:</span> <span class="token string">&quot;11.1&quot;</span><span class="token punctuation">,</span>
                       <span class="token punctuation">}</span><span class="token punctuation">,</span>
                       useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
                       corejs<span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 声明corejs版本</span>
                   <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
                    <span class="token comment">// 开发第三方模块时的写法</span>
                    <span class="token comment">/*
                    &quot;plugins&quot;: [
                        [
                            &quot;@babel/plugin-transform-runtime&quot;,
                            {
                                &quot;absoluteRuntime&quot;: false,
                                &quot;corejs&quot;: 2,
                                &quot;helpers&quot;: true,
                                &quot;regenerator&quot;: true,
                                &quot;useESModules&quot;: false
                            }
                        ]
                    ]
                    */</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token string">'src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>webpack.dev.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 合并配置插件</span>

<span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span> <span class="token comment">// 开发模式</span>
    <span class="token comment">//devtool: 'source-map', // 设置为none时无法定位语法错误发生在源代码里第几行</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">,</span>  <span class="token comment">// 开发模式最佳配置</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        usedExports<span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// tree shaking 配置,开发模式下需要配置，生产模式不需要，默认会tree shaking</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 配置devServer</span>
        contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>  <span class="token comment">// 打包后起服务的目录名</span>
        open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token comment">// 自动打开浏览器</span>
        proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token string">'http://localhost:3000'</span>  <span class="token comment">// 跨域代理转发</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        port<span class="token operator">:</span> <span class="token number">8090</span><span class="token punctuation">,</span>  <span class="token comment">// 指定端口号</span>
        hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 开启热模块替换</span>
        <span class="token comment">//hotOnly: true  // 即便热模块替换没有生效，不让浏览器自动刷新</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结合</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>package.json</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --config ./build/webpack.dev.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config ./build/webpack.prod.js&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="三、code-splitting"><a href="#三、code-splitting" class="header-anchor">#</a> 三、Code Splitting</h2> <p>webpack默认会打包成一个bundle.js，打包出来的文件会很大，加载时间会很长，另外像loadash这样的第三方库是不需要打包的。</p> <h3 id="优化方式"><a href="#优化方式" class="header-anchor">#</a> 优化方式</h3> <ul><li>方法1：手动抽离第三方模块，使用多入口进行打包（不推荐）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// loadash.js</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>_ <span class="token operator">=</span> _<span class="token punctuation">;</span>

<span class="token comment">// webpack.config.js</span>
entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    loadsh<span class="token operator">:</span> <span class="token string">'./src/loadsah.js'</span><span class="token punctuation">,</span>
    main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> <span class="token comment">// 第一个入口文件</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>方法2：用webpack4自带的插件配置（支持同步引入）</li></ul> <p>由于webpack4 天然支持动态import的模块的code Splitting，所以对于动态import的模块不需要配置任何东西。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">function</span> <span class="token function">getComponet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 异步载入语法import()，webpack4已经支持code Splitting,不需要任何配置</span>
    <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> _ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> ele <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ele<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ele<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">getComponet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">ele</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>但如果是通过import xxx from xxx这样静态引入的模块，则还需要额外配置东西</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token operator">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ********Code Splitting配置，支持静态引入的模块********</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
        chunks<span class="token operator">:</span> <span class="token string">'all'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="更多配置参数"><a href="#更多配置参数" class="header-anchor">#</a> 更多配置参数</h3> <p>针对动态引入的import的打包，可以配置更多参数，比如修改生成的chunk的名字。</p> <p>安装一个插件</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>syntax<span class="token operator">-</span>dynamic<span class="token operator">-</span><span class="token keyword">import</span>
</code></pre></div><p>.babelrc配置：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改打包后的名字</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">function</span> <span class="token function">getComponet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName:&quot;loadash&quot; */</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> _ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> ele <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ele<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ele<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>/* webpackChunkName:&quot;loadash&quot; */   意思是为打包生成的loadash起一个名字。默认动态import生成的名字是 <code>数字.js</code></p> <p>这样配置后，打包后的名字会变成vender-loadash.js，如果不需要带vender，则需要修改webpack配置：</p> <div class="language-js extra-class"><pre class="language-js"><code> optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Code Splitting配置</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
        chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
        cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
            vendors<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置：https://www.webpackjs.com/plugins/split-chunks-plugin/</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 全部配置</span>
optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Code Splitting配置</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// chunks: 'all',</span>
        <span class="token comment">// cacheGroups: {</span>
        <span class="token comment">//     vendors: false,</span>
        <span class="token comment">//     default: false</span>
        <span class="token comment">// }</span>
        chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// async，只对异步代码进行code spliting，all就是同步异步都分割</span>
        minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 代码分割最小的文件大小</span>
        minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 至少有1个chunk引用了这个模块，才会code Spliting</span>
        maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// vendors</span>
            vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>  <span class="token comment">// 代码必须在node_module里面才会分到这个vendors组</span>
                priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>  <span class="token comment">// 打包的权重，会选择priority大的打包</span>
                filename<span class="token operator">:</span> <span class="token string">&quot;vendors.js&quot;</span>  <span class="token comment">// 仅对同步引入的模块生效,修改文件名</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
                reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果一个模块被打包过了，则直接复用，不再做打包</span>
                filename<span class="token operator">:</span> <span class="token string">&quot;common.js&quot;</span> <span class="token comment">// 仅对同步引入的模块生效,修改文件名</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>异步加载的模块不能设置filename</p> <h2 id="四、lazy-loading-懒加载，chunk是什么"><a href="#四、lazy-loading-懒加载，chunk是什么" class="header-anchor">#</a> 四、Lazy Loading 懒加载，chunk是什么</h2> <p>动态import()方法引入的模块会有懒加载的功能。打包后的每个js文件都是一个chunk。</p> <h2 id="五、打包分析、preloading、prefetching"><a href="#五、打包分析、preloading、prefetching" class="header-anchor">#</a> 五、打包分析、preloading、prefetching</h2> <h3 id="_1、打包分析"><a href="#_1、打包分析" class="header-anchor">#</a> 1、打包分析</h3> <div class="language-js extra-class"><pre class="language-js"><code>webpack <span class="token operator">--</span>profile <span class="token operator">--</span>json <span class="token operator">&gt;</span> stats<span class="token punctuation">.</span>json <span class="token operator">--</span>config <span class="token punctuation">.</span><span class="token operator">/</span>build<span class="token operator">/</span>webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js&quot;
</code></pre></div><p>在webpack命令后面加--profile --json &gt; stats.json</p> <h3 id="_2、preloading（不太适用）、prefetching-使用场景"><a href="#_2、preloading（不太适用）、prefetching-使用场景" class="header-anchor">#</a> 2、preloading（不太适用）、prefetching 使用场景</h3> <p>举个例子，比如下面这样的代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ele <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ele<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>点击后添加一个节点。其实我们可以把添加节点的逻辑通过异步import的方式进行优化，即异步加载（即懒加载）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./click.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> _ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// click.js</span>
<span class="token keyword">function</span> <span class="token function">handClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ele <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ele<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> handClick<span class="token punctuation">;</span>
</code></pre></div><p>这样异步加载，减少了bundle的体积大小。但是异步加载也有一个问题，就是异步加载的时候可能会比较慢，特别是有图片的时候，用户体验不好。解决办法是，在网络空闲的时候进行异步加载。</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch:true */</span> <span class="token string">'./click.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> _ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>/* webpackPrefetch:true */  意思就是在网络空闲的时候去异步加载。</p> <h2 id="六、css文件代码分割"><a href="#六、css文件代码分割" class="header-anchor">#</a> 六、CSS文件代码分割</h2> <ul><li>分离CSS</li></ul> <p>安装css代码分割插件。</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev mini<span class="token operator">-</span>css<span class="token operator">-</span>extract<span class="token operator">-</span>plugin
</code></pre></div><p>webpack配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.prod.js</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 合并配置插件</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token comment">// 生产模式</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>  <span class="token comment">//生产模式最佳配置</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            filename<span class="token operator">:</span> <span class="token string">'[name].css'</span><span class="token punctuation">,</span>
            chunkFilename<span class="token operator">:</span> <span class="token string">'[id].css'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(css|scss)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>  <span class="token comment">//  把style-loader换成MiniCssExtractPlugin.loader</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                        options<span class="token operator">:</span> <span class="token punctuation">{</span>
                            importLoaders<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                            modules<span class="token operator">:</span> <span class="token boolean">true</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//tree shaking 配置</span>
        usedExports<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 结合</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>package.json配置：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;learn-webpack&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;*.scss&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;*.css&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意package.json也要作配置。这个插件用于生产环境。</p> <ul><li>压缩CSS和JS</li></ul> <p>安装压缩css和js的插件</p> <div class="language-js extra-class"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> optimize<span class="token operator">-</span>css<span class="token operator">-</span>assets<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin terser<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin
</code></pre></div><p>webpack.prod.js配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TerserJSPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 合并配置插件</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token comment">// 生产模式</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>  <span class="token comment">//生产模式最佳配置</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 分离css</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            filename<span class="token operator">:</span> <span class="token string">'[name].css'</span><span class="token punctuation">,</span>
            chunkFilename<span class="token operator">:</span> <span class="token string">'[id].css'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(css|scss)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>  <span class="token comment">//  把style-loader换成MiniCssExtractPlugin.loader</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                        options<span class="token operator">:</span> <span class="token punctuation">{</span>
                            importLoaders<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                            modules<span class="token operator">:</span> <span class="token boolean">true</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 压缩CSS和js</span>
        minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserJSPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//使用 UglifyJS 压缩混淆 js 代码</span>
            <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 压缩css</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结合</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意，不适用这两个插件的情况下，JS会压缩，CSS不会压缩。如果使用了OptimizeCSSAssetsPlugin，则css会压缩而JS不会压缩，要使js也能被压缩，则需要使用TerserJSPlugin来压缩JS。</p> <ul><li>将所有CSS打包到一个css文件里面</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//压缩CSS和js</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">TerserJSPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//使用 UglifyJS 压缩混淆 js 代码</span>
        <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 压缩css</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 将所有css合并到一个css里面</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
        cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
            styles<span class="token operator">:</span> <span class="token punctuation">{</span>
                name<span class="token operator">:</span> <span class="token string">'styles'</span><span class="token punctuation">,</span>
                test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
                enforce<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://webpack.js.org/plugins/mini-css-extract-plugin/#minimizing-for-production" target="_blank" rel="noopener noreferrer">参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="七、webpack与浏览器缓存"><a href="#七、webpack与浏览器缓存" class="header-anchor">#</a> 七、webpack与浏览器缓存</h2> <p>浏览器缓存。生产环境下配置contenthash，这样当重新打包的时候，用户就只会重新加载发生改变了的文件，没有改变的文件则使用缓存。</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 生产环境下，需要这么写，因为缓存的问题</span>
output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].[contenthash].js'</span><span class="token punctuation">,</span> <span class="token comment">// 打包后的文件的名字,[name]是占位符，是上面的entry里的main或者sub</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">'[name].[contenthash].js'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="八、shimming-的作用"><a href="#八、shimming-的作用" class="header-anchor">#</a> 八、Shimming 的作用</h2> <p>代码兼容或者打包过程的兼容，解决兼容的问题</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token operator">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 当任何一个模块中用了$,就自动加载juqery模块，并导入命名为$   </span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       $<span class="token operator">:</span><span class="token string">'jquery'</span><span class="token punctuation">,</span>
       _<span class="token operator">:</span><span class="token string">'lodash'</span><span class="token punctuation">,</span>
       _join<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'loadsh'</span><span class="token punctuation">,</span><span class="token string">'join'</span><span class="token punctuation">]</span>           
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="九、环境变量的使用"><a href="#九、环境变量的使用" class="header-anchor">#</a> 九、环境变量的使用</h2> <p>使用环境变量前：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack.common.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//entry: './src/index.js', // 入口文件，等价于下面的main</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span> <span class="token comment">// 第一个入口文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    performance<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// 打包出口</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//publicPath: '/',  // webpackDevServer要配置这个</span>
        <span class="token comment">// publicPath: 'http://cdn.com/',  // 在打包后生成的js地址前面加上域名，即http://cdn.com/main.js</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span> <span class="token comment">// 打包后的目录,必须使用绝对路径,要用到path.resolve</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 配置相关loader</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|jpeg)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// loader: 'file-loader',  // 使用 file-loader 打包</span>
                    <span class="token comment">// options: {</span>
                    <span class="token comment">//     name: '[name].[ext]',// 配置打包后图片的名字,[name]就是图片的原名字,[ext]是原后缀</span>
                    <span class="token comment">//     outputPath: 'images/',  // 将打包后的图片放在images目录下，不配置则会放在根目录下</span>
                    <span class="token comment">// }</span>
                    loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span> <span class="token comment">// 使用 url-loader 打包，在文件大小（单位 byte）低于指定的限制时，可以返回一个 DataURL。</span>
                    options<span class="token operator">:</span> <span class="token punctuation">{</span>
                        name<span class="token operator">:</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span><span class="token comment">// 配置打包后图片的名字,[name]就是图片的原名字,[ext]是原后缀</span>
                        outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>  <span class="token comment">// 将打包后的图片放在images目录下，不配置则会放在根目录下</span>
                        limit<span class="token operator">:</span> <span class="token number">2048</span>  <span class="token comment">// 图片小于2048字节就会打包成base64</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(eot|ttf|svg)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">{</span>
                    loader<span class="token operator">:</span> <span class="token string">'file-loader'</span>  <span class="token comment">// 使用 file-loader 打包</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 开发业务代码时的写法</span>
                    <span class="token comment">//presets: [&quot;@babel/preset-env&quot;]</span>
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                        targets<span class="token operator">:</span> <span class="token punctuation">{</span>
                            edge<span class="token operator">:</span> <span class="token string">&quot;17&quot;</span><span class="token punctuation">,</span>
                            firefox<span class="token operator">:</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">,</span>
                            chrome<span class="token operator">:</span> <span class="token string">&quot;67&quot;</span><span class="token punctuation">,</span>
                            safari<span class="token operator">:</span> <span class="token string">&quot;11.1&quot;</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
                        corejs<span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 声明corejs版本</span>
                    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
                    <span class="token comment">// 开发第三方模块时的写法</span>
                    <span class="token comment">/*
                    &quot;plugins&quot;: [
                        [
                            &quot;@babel/plugin-transform-runtime&quot;,
                            {
                                &quot;absoluteRuntime&quot;: false,
                                &quot;corejs&quot;: 2,
                                &quot;helpers&quot;: true,
                                &quot;regenerator&quot;: true,
                                &quot;useESModules&quot;: false
                            }
                        ]
                    ]
                    */</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token string">'src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 当任何一个模块中用了$,就自动加载juqery模块，并导入命名为$   </span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
           $<span class="token operator">:</span><span class="token string">'jquery'</span><span class="token punctuation">,</span>
           _<span class="token operator">:</span><span class="token string">'lodash'</span><span class="token punctuation">,</span>
           _join<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'loadsh'</span><span class="token punctuation">,</span><span class="token string">'join'</span><span class="token punctuation">]</span>           
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//tree shaking 配置</span>
        usedExports<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 开发模式下需要配置，生产模式不需要，默认会tree shaking</span>
        <span class="token comment">// Code Splitting配置</span>
        splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// chunks: 'all',</span>
            <span class="token comment">// cacheGroups: {</span>
            <span class="token comment">//     vendors: false,</span>
            <span class="token comment">//     default: false</span>
            <span class="token comment">// }</span>
            chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// async，只对异步代码进行code spliting，all就是同步异步都分割</span>
            minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 代码分割最小的文件大小</span>
            minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 至少有1个chunk引用了这个模块，才会code Spliting</span>
            maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
            maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// vendors</span>
                vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
                    test<span class="token operator">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>  <span class="token comment">// 代码必须在node_module里面才会分到这个vendors组</span>
                    priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>  <span class="token comment">// 打包的权重，会选择priority大的打包</span>
                    <span class="token comment">//filename: &quot;vendors.js&quot;  // 仅对同步引入的模块生效,修改文件名</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
                    reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果一个模块被打包过了，则直接复用，不再做打包</span>
                    <span class="token comment">//filename: &quot;common.js&quot; // 仅对同步引入的模块生效,修改文件名</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token comment">//  webpack.dev.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 合并配置插件</span>

<span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span> <span class="token comment">// 开发模式</span>
    <span class="token comment">//devtool: 'source-map', // 设置为none时无法定位语法错误发生在源代码里第几行</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">,</span>  <span class="token comment">// 开发模式最佳配置</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(css|scss)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                        options<span class="token operator">:</span> <span class="token punctuation">{</span>
                            importLoaders<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                            modules<span class="token operator">:</span> <span class="token boolean">true</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 配置devServer</span>
        contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>  <span class="token comment">// 打包后起服务的目录名</span>
        open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token comment">// 自动打开浏览器</span>
        proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token string">'http://localhost:3000'</span>  <span class="token comment">// 跨域代理转发</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        port<span class="token operator">:</span> <span class="token number">8090</span><span class="token punctuation">,</span>  <span class="token comment">// 指定端口号</span>
        hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 开启热模块替换</span>
        <span class="token comment">//hotOnly: true  // 即便热模块替换没有生效，不让浏览器自动刷新</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 开发环境下，不用担心缓存的问题</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].[hash].js'</span><span class="token punctuation">,</span> <span class="token comment">// 打包后的文件的名字,[name]是占位符，是上面的entry里的main或者sub</span>
        chunkFilename<span class="token operator">:</span> <span class="token string">'[name].[hash].js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结合</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token comment">// webpack.prod.js</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TerserJSPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 合并配置插件</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token comment">// 生产模式</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>  <span class="token comment">//生产模式最佳配置</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 分离css</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            filename<span class="token operator">:</span> <span class="token string">'[name].css'</span><span class="token punctuation">,</span>
            chunkFilename<span class="token operator">:</span> <span class="token string">'[id].css'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(css|scss)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>  <span class="token comment">//  把style-loader换成MiniCssExtractPlugin.loader</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                        options<span class="token operator">:</span> <span class="token punctuation">{</span>
                            importLoaders<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                            modules<span class="token operator">:</span> <span class="token boolean">true</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//压缩CSS和js</span>
        minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserJSPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//使用 UglifyJS 压缩混淆 js 代码</span>
            <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 压缩css</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 将所有css合并到一个css里面</span>
        splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
            cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
                styles<span class="token operator">:</span> <span class="token punctuation">{</span>
                    name<span class="token operator">:</span> <span class="token string">'styles'</span><span class="token punctuation">,</span>
                    test<span class="token operator">:</span> <span class="token regex">/\.(css|scss)$/</span><span class="token punctuation">,</span>
                    chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
                    enforce<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 生产环境下，需要这么写，因为缓存的问题</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].[contenthash].js'</span><span class="token punctuation">,</span> <span class="token comment">// 打包后的文件的名字,[name]是占位符，是上面的entry里的main或者sub</span>
        chunkFilename<span class="token operator">:</span> <span class="token string">'[name].[contenthash].js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结合</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用环境变量后：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.common.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.dev.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.prod.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//entry: './src/index.js', // 入口文件，等价于下面的main</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span> <span class="token comment">// 第一个入口文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    performance<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// 打包出口</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//publicPath: '/',  // webpackDevServer要配置这个</span>
        <span class="token comment">// publicPath: 'http://cdn.com/',  // 在打包后生成的js地址前面加上域名，即http://cdn.com/main.js</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span> <span class="token comment">// 打包后的目录,必须使用绝对路径,要用到path.resolve</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 配置相关loader</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|jpeg)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// loader: 'file-loader',  // 使用 file-loader 打包</span>
                    <span class="token comment">// options: {</span>
                    <span class="token comment">//     name: '[name].[ext]',// 配置打包后图片的名字,[name]就是图片的原名字,[ext]是原后缀</span>
                    <span class="token comment">//     outputPath: 'images/',  // 将打包后的图片放在images目录下，不配置则会放在根目录下</span>
                    <span class="token comment">// }</span>
                    loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span> <span class="token comment">// 使用 url-loader 打包，在文件大小（单位 byte）低于指定的限制时，可以返回一个 DataURL。</span>
                    options<span class="token operator">:</span> <span class="token punctuation">{</span>
                        name<span class="token operator">:</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span><span class="token comment">// 配置打包后图片的名字,[name]就是图片的原名字,[ext]是原后缀</span>
                        outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>  <span class="token comment">// 将打包后的图片放在images目录下，不配置则会放在根目录下</span>
                        limit<span class="token operator">:</span> <span class="token number">2048</span>  <span class="token comment">// 图片小于2048字节就会打包成base64</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(eot|ttf|svg)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">{</span>
                    loader<span class="token operator">:</span> <span class="token string">'file-loader'</span>  <span class="token comment">// 使用 file-loader 打包</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 开发业务代码时的写法</span>
                    <span class="token comment">//presets: [&quot;@babel/preset-env&quot;]</span>
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                        targets<span class="token operator">:</span> <span class="token punctuation">{</span>
                            edge<span class="token operator">:</span> <span class="token string">&quot;17&quot;</span><span class="token punctuation">,</span>
                            firefox<span class="token operator">:</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">,</span>
                            chrome<span class="token operator">:</span> <span class="token string">&quot;67&quot;</span><span class="token punctuation">,</span>
                            safari<span class="token operator">:</span> <span class="token string">&quot;11.1&quot;</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
                        corejs<span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 声明corejs版本</span>
                    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
                    <span class="token comment">// 开发第三方模块时的写法</span>
                    <span class="token comment">/*
                    &quot;plugins&quot;: [
                        [
                            &quot;@babel/plugin-transform-runtime&quot;,
                            {
                                &quot;absoluteRuntime&quot;: false,
                                &quot;corejs&quot;: 2,
                                &quot;helpers&quot;: true,
                                &quot;regenerator&quot;: true,
                                &quot;useESModules&quot;: false
                            }
                        ]
                    ]
                    */</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token string">'src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 当任何一个模块中用了$,就自动加载juqery模块，并导入命名为$   </span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            $<span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
            _<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            _join<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'loadsh'</span><span class="token punctuation">,</span> <span class="token string">'join'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//tree shaking 配置</span>
        usedExports<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 开发模式下需要配置，生产模式不需要，默认会tree shaking</span>
        <span class="token comment">// Code Splitting配置</span>
        splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// chunks: 'all',</span>
            <span class="token comment">// cacheGroups: {</span>
            <span class="token comment">//     vendors: false,</span>
            <span class="token comment">//     default: false</span>
            <span class="token comment">// }</span>
            chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// async，只对异步代码进行code spliting，all就是同步异步都分割</span>
            minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 代码分割最小的文件大小</span>
            minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 至少有1个chunk引用了这个模块，才会code Spliting</span>
            maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
            maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// vendors</span>
                vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
                    test<span class="token operator">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>  <span class="token comment">// 代码必须在node_module里面才会分到这个vendors组</span>
                    priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>  <span class="token comment">// 打包的权重，会选择priority大的打包</span>
                    <span class="token comment">//filename: &quot;vendors.js&quot;  // 仅对同步引入的模块生效,修改文件名</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
                    reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果一个模块被打包过了，则直接复用，不再做打包</span>
                    <span class="token comment">//filename: &quot;common.js&quot; // 仅对同步引入的模块生效,修改文件名</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果是线上环境</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>env <span class="token operator">&amp;&amp;</span> env<span class="token punctuation">.</span>production<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>





<span class="token comment">// webpack.dev.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span> <span class="token comment">// 开发模式</span>
    <span class="token comment">//devtool: 'source-map', // 设置为none时无法定位语法错误发生在源代码里第几行</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">,</span>  <span class="token comment">// 开发模式最佳配置</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(css|scss)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                        options<span class="token operator">:</span> <span class="token punctuation">{</span>
                            importLoaders<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                            modules<span class="token operator">:</span> <span class="token boolean">true</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 配置devServer</span>
        contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>  <span class="token comment">// 打包后起服务的目录名</span>
        open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token comment">// 自动打开浏览器</span>
        proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token string">'http://localhost:3000'</span>  <span class="token comment">// 跨域代理转发</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        port<span class="token operator">:</span> <span class="token number">8090</span><span class="token punctuation">,</span>  <span class="token comment">// 指定端口号</span>
        hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 开启热模块替换</span>
        <span class="token comment">//hotOnly: true  // 即便热模块替换没有生效，不让浏览器自动刷新</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 开发环境下，不用担心缓存的问题</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].[hash].js'</span><span class="token punctuation">,</span> <span class="token comment">// 打包后的文件的名字,[name]是占位符，是上面的entry里的main或者sub</span>
        chunkFilename<span class="token operator">:</span> <span class="token string">'[name].[hash].js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结合</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> devConfig





<span class="token comment">// webpack.prod.js</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TerserJSPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token comment">// 生产模式</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>  <span class="token comment">//生产模式最佳配置</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 分离css</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            filename<span class="token operator">:</span> <span class="token string">'[name].css'</span><span class="token punctuation">,</span>
            chunkFilename<span class="token operator">:</span> <span class="token string">'[id].css'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(css|scss)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>  <span class="token comment">//  把style-loader换成MiniCssExtractPlugin.loader</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                        options<span class="token operator">:</span> <span class="token punctuation">{</span>
                            importLoaders<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                            modules<span class="token operator">:</span> <span class="token boolean">true</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//压缩CSS和js</span>
        minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserJSPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//使用 UglifyJS 压缩混淆 js 代码</span>
            <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 压缩css</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 将所有css合并到一个css里面</span>
        splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
            cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
                styles<span class="token operator">:</span> <span class="token punctuation">{</span>
                    name<span class="token operator">:</span> <span class="token string">'styles'</span><span class="token punctuation">,</span>
                    test<span class="token operator">:</span> <span class="token regex">/\.(css|scss)$/</span><span class="token punctuation">,</span>
                    chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
                    enforce<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 生产环境下，需要这么写，因为缓存的问题</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].[contenthash].js'</span><span class="token punctuation">,</span> <span class="token comment">// 打包后的文件的名字,[name]是占位符，是上面的entry里的main或者sub</span>
        chunkFilename<span class="token operator">:</span> <span class="token string">'[name].[contenthash].js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结合</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> prodConfig<span class="token punctuation">;</span>





<span class="token comment">// package.json</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --config ./build/webpack.common.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --env.production --config ./build/webpack.common.js&quot;</span>
 <span class="token punctuation">}</span>
</code></pre></div><h2 id="十、library的打包"><a href="#十、library的打包" class="header-anchor">#</a> 十、Library的打包</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
output<span class="token operator">:</span> <span class="token punctuation">{</span>
    libraryTarget<span class="token operator">:</span><span class="token string">'umd'</span><span class="token punctuation">,</span>  <span class="token comment">// 支持常用的模块引入方式</span>
    library<span class="token operator">:</span><span class="token string">'library'</span> <span class="token comment">// 支持script标签引入</span>
<span class="token punctuation">}</span>，
externals<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">]</span>  <span class="token comment">// 避免库所依赖的模块被多次打包</span>


<span class="token comment">// package.json</span>
<span class="token string">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.js&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 配置main为打包后的库文件的路径</span>
</code></pre></div><p>如果我们需要使得打包出来的库文件支持多种模块引入方法（commonJS、ES Module、amd），就需要在output里面配置 libraryTarget:'umd' 参数。</p> <p>如果需要将library挂载到window下面，则可以配置 library:'library' ，值是我们希望取的window下的名字，即全局变量的名字。</p> <p>externals:['lodash']         避免库所依赖的模块被多次打，只在业务里打包就行，不在库里打包。</p> <h2 id="十一、pwa的打包"><a href="#十一、pwa的打包" class="header-anchor">#</a> 十一、PWA的打包</h2> <p>Progressive Web App,即渐进式WEB应用。用户第一次访问某个服务器的web 页面，访问成功，当服务器挂了的时候，用户还能继续访问，但不是访问服务器而是访问本地缓存。这就叫做PWA。</p> <p>安装workbox-webpack-plugin</p> <div class="language-js extra-class"><pre class="language-js"><code>npm i workbox<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>配置webpack：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.prod.js</span>
<span class="token keyword">const</span> WorkboxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'workbox-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 分离css</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].css'</span><span class="token punctuation">,</span>
        chunkFilename<span class="token operator">:</span> <span class="token string">'[id].css'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 应用这个插件</span>
    <span class="token keyword">new</span> <span class="token class-name">WorkboxWebpackPlugin<span class="token punctuation">.</span>GenerateSW</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        clientsClaim<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        skipWaiting<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>

</code></pre></div><p>业务代码加入以下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/service-worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">registration</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ServiceWorker registered'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ServiceWorker registered err'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="十二、typescript-的打包配置"><a href="#十二、typescript-的打包配置" class="header-anchor">#</a> 十二、TypeScript 的打包配置</h2> <p>安装 ts-loader和 typescript</p> <div class="language-js extra-class"><pre class="language-js"><code> npm i <span class="token operator">-</span><span class="token constant">D</span> ts<span class="token operator">-</span>loader typescript
</code></pre></div><p>webpack配置:</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/\.ts$/</span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token string">&quot;ts-loader&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置tsconfig.json</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es6&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es3&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;allowJs&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;noImplicitAny&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;removeComments&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;preserveConstEnums&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sourceMap&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;src/**/*&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;**/*.spec.ts&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果需要在ts文件里面对loadsh使用的语法进行自动检查，则还需要安装@types/loadsh。</p> <p><a href="https://www.tslang.cn/docs/handbook/tsconfig-json.html" target="_blank" rel="noopener noreferrer">更多tsconfig.json的配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="十三、使用-webpackdevserver-实现请求转发"><a href="#十三、使用-webpackdevserver-实现请求转发" class="header-anchor">#</a> 十三、使用 WebpackDevServer 实现请求转发</h2> <h3 id="_1、路径替换"><a href="#_1、路径替换" class="header-anchor">#</a> 1、路径替换</h3> <p>接口地址：http://www.dell-lee.com/react/api/header.json</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/header.json&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>webpack配置:</p> <div class="language-js extra-class"><pre class="language-js"><code>devServer<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 配置devServer</span>
    contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>  <span class="token comment">// 打包后起服务的目录名</span>
    <span class="token comment">//open: true,   // 自动打开浏览器</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'/header.json'</span><span class="token operator">:</span> <span class="token string">'http://www.dell-lee.com/react/api'</span>  <span class="token comment">// 跨域代理转发,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">8090</span><span class="token punctuation">,</span>  <span class="token comment">// 指定端口号</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 开启热模块替换</span>
    hotOnly<span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// 即便热模块替换没有生效，不让浏览器自动刷新</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>配置方法：</li></ul> <p>当遇到/header.json时，则把 <code>http://www.dell-lee.com/react/api/header.json</code> 地址 /header.json 前面的部分，也就是 <code>http://www.dell-lee.com/react/api</code> 配置一下就可以。</p> <p>所以以下配置也是可以的:</p> <div class="language-js extra-class"><pre class="language-js"><code>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/header.json&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>webpack配置:</p> <div class="language-js extra-class"><pre class="language-js"><code>devServer<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 配置devServer</span>
    contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>  <span class="token comment">// 打包后起服务的目录名</span>
    <span class="token comment">//open: true,   // 自动打开浏览器</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token string">'http://www.dell-lee.com/react'</span>  <span class="token comment">// 跨域代理转发</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">8090</span><span class="token punctuation">,</span>  <span class="token comment">// 指定端口号</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 开启热模块替换</span>
    hotOnly<span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// 即便热模块替换没有生效，不让浏览器自动刷新</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="_2、路径重写"><a href="#_2、路径重写" class="header-anchor">#</a> 2、路径重写</h3> <p>两个接口如下：</p> <p>http://www.dell-lee.com/react/api/demo.json  （测试数据）</p> <p>http://www.dell-lee.com/react/api/header.json  （正式数据）</p> <div class="language-js extra-class"><pre class="language-js"><code>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/header.json&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>使用以上代码，如果不使用路径重写，则会请求到正式数据，如果我们需要请求到测试数据，则需要使用路径重写。</p> <div class="language-js extra-class"><pre class="language-js"><code> devServer<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 配置devServer</span>
    contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>  <span class="token comment">// 打包后起服务的目录名</span>
    <span class="token comment">//open: true,   // 自动打开浏览器</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// '/api': 'http://www.dell-lee.com/react'  // 跨域代理转发</span>
        <span class="token comment">// 下面进行路径重写</span>
        <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            target<span class="token operator">:</span> <span class="token string">'http://www.dell-lee.com/react'</span><span class="token punctuation">,</span>
            pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;header.json&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demo.json&quot;</span> <span class="token comment">// 把header.json换成demo.json</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">8090</span><span class="token punctuation">,</span>  <span class="token comment">// 指定端口号</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 开启热模块替换</span>
    hotOnly<span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// 即便热模块替换没有生效，不让浏览器自动刷新</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3、支持https的转发"><a href="#_3、支持https的转发" class="header-anchor">#</a> 3、支持https的转发</h3> <p>如果后台接口是https，则需要加下secure:false</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'/api'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token string">'https://www.dell-lee.com/react'</span><span class="token punctuation">,</span>
    secure<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
    pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;header.json&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demo.json&quot;</span> <span class="token comment">// 把header.json换成demo.json</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4、支持转发跨域的请求"><a href="#_4、支持转发跨域的请求" class="header-anchor">#</a> 4、支持转发跨域的请求</h3> <p>加 changeOrigin:true</p> <div class="language-js extra-class"><pre class="language-js"><code> proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// '/api': 'http://www.dell-lee.com/react'  // 跨域代理转发</span>
    <span class="token comment">// 下面进行路径重写</span>
    <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        target<span class="token operator">:</span> <span class="token string">'http://www.dell-lee.com/react'</span><span class="token punctuation">,</span>
        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;header.json&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demo.json&quot;</span> <span class="token comment">// 把header.json换成demo.json</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        changeOrigin<span class="token operator">:</span><span class="token boolean">true</span>   <span class="token comment">// 跨域，改变origin</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="十四、使用webpackdevserver解决单页面应用路由问题"><a href="#十四、使用webpackdevserver解决单页面应用路由问题" class="header-anchor">#</a> 十四、使用WebpackDevServer解决单页面应用路由问题</h2> <p>React代码，会发现当访问 http://localhost:8090/ 时，可以展示home页面，但是访问 http://localhost:8090/list 时，会404,。这是因为在服务端，默认会认为 http://localhost:8090/list 这个是访问 http://localhost:8090/list.html ，但实际上并没有list.html，所以就会报错。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter<span class="token punctuation">,</span> Route <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'./home'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> List <span class="token keyword">from</span> <span class="token string">'./list'</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
   <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
         <span class="token operator">&lt;</span>BrowserRouter<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
               <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/'</span> exact component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">&gt;</span>
               <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/list'</span> component<span class="token operator">=</span><span class="token punctuation">{</span>List<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>解决方法是，修改devServer的配置</p> <div class="language-js extra-class"><pre class="language-js"><code> devServer<span class="token operator">:</span> <span class="token punctuation">{</span>  
   historyApiFallback<span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// 解决单页面应用路由问题,等价于如果找不到页面，则返回index.html页面。即路由重写。</span>
 <span class="token punctuation">}</span>
</code></pre></div><h2 id="十五、eslint-在-webpack-中的配置"><a href="#十五、eslint-在-webpack-中的配置" class="header-anchor">#</a> 十五、EsLint 在 Webpack 中的配置</h2> <p>安装eslint：<code>npm i eslint -D</code></p> <p>初始化eslint的配置文件：<code>npx eslint --init</code></p> <ul><li>使用eslint</li></ul> <p>1、<code>npx eslint src</code>
安装 <code>npm i babel-eslint -D</code>  ，检查src目录下的文件,会发现一些语法没法用，比如jsx。需要使用<code>npx eslint src</code> ；来进一步解析代码是哪里不规范了。</p> <p>2、用VS Code插件
用VS Code编辑器安装ESlint 插件，代码会自动标红。</p> <ul><li>使用eslint-loader结合overlay实现在页面上提示代码不规范</li></ul> <p>安装 eslint-loader： <code>npm i -D eslint-loader</code></p> <p>webpack配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">&quot;eslint-loader&quot;</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
            fix<span class="token operator">:</span> <span class="token boolean">true</span>   <span class="token comment">// 自动修复一些不规范的地方</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>



devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
     overlay<span class="token operator">:</span><span class="token boolean">true</span>  <span class="token comment">// 在页面上提示代码不规范</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>不需要遵循某些规范，可以这样配置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// .eslintrc.js</span>
rules<span class="token operator">:</span><span class="token punctuation">{</span>
   <span class="token string">'import/no-extraneous-dependencies'</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// 不使用这个规范</span>
   <span class="token string">'react/prefer-stateless-function'</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
   <span class="token string">'react/jsx-filename-extension'</span><span class="token operator">:</span><span class="token number">0</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>eslint配置文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
 env<span class="token operator">:</span> <span class="token punctuation">{</span>
   browser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   es6<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 rules<span class="token operator">:</span><span class="token punctuation">{</span>
   <span class="token string">'import/no-extraneous-dependencies'</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// 不使用这个规范</span>
   <span class="token string">'react/prefer-stateless-function'</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
   <span class="token string">'react/jsx-filename-extension'</span><span class="token operator">:</span><span class="token number">0</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 parser<span class="token operator">:</span> <span class="token string">&quot;babel-eslint&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 用babel-eslint去检查</span>
 <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token string">'airbnb'</span><span class="token punctuation">,</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
 globals<span class="token operator">:</span> <span class="token punctuation">{</span>
   Atomics<span class="token operator">:</span> <span class="token string">'readonly'</span><span class="token punctuation">,</span>
   SharedArrayBuffer<span class="token operator">:</span> <span class="token string">'readonly'</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 parserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
   ecmaFeatures<span class="token operator">:</span> <span class="token punctuation">{</span>
     jsx<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   ecmaVersion<span class="token operator">:</span> <span class="token number">2018</span><span class="token punctuation">,</span>
   sourceType<span class="token operator">:</span> <span class="token string">'module'</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token string">'react'</span><span class="token punctuation">,</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="十六、webpack性能优化"><a href="#十六、webpack性能优化" class="header-anchor">#</a> 十六、webpack性能优化</h2> <h4 id="_1、跟上技术的迭代（node、npm、webpack）"><a href="#_1、跟上技术的迭代（node、npm、webpack）" class="header-anchor">#</a> 1、跟上技术的迭代（Node、NPM、Webpack）</h4> <h4 id="_2、在尽可能少的模块上应用loader-（使用exclude或者include）"><a href="#_2、在尽可能少的模块上应用loader-（使用exclude或者include）" class="header-anchor">#</a> 2、在尽可能少的模块上应用loader （使用exclude或者include）</h4> <h4 id="_3、plugin尽可能精简并确保可靠"><a href="#_3、plugin尽可能精简并确保可靠" class="header-anchor">#</a> 3、Plugin尽可能精简并确保可靠</h4> <h4 id="_4、resolve参数合理配置"><a href="#_4、resolve参数合理配置" class="header-anchor">#</a> 4、resolve参数合理配置</h4> <div class="language-js extra-class"><pre class="language-js"><code>   entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span> <span class="token comment">// 第一个入口文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
        extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">,</span><span class="token string">'.vue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 如果import引入的文件不带后缀名，则先找.js结尾的，再找.jsx结尾的，最后找.vue结尾的。 </span>
        mainFiles<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token string">'child'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 如果import引入了一个目录，但没有写具体文件的名字，则先看有没有index名字的文件，如果没有，再看有没有child名字的文件</span>
        alias<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'@src'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>extensions 配置</li></ul> <p><code>extensions: ['.js', '.jsx','.vue'],</code></p> <p>如果import引入的文件不带后缀名，则先找.js结尾的，再找.jsx结尾的，最后找.vue结尾的。</p> <p>比如  <code>import abc from './app/index'</code></p> <ul><li>mainFiles 配置</li></ul> <p><code>mainFiles:['index','child']</code></p> <p>如果import引入了一个目录，但没有写具体文件的名字，则先看有没有index名字的文件，如果没有，再看有没有child名字的文件。</p> <p>比如  <code>import abc from './app/'</code></p> <ul><li>alias 配置</li></ul> <div class="language- extra-class"><pre class="language-text"><code>alias: {
    '@src': path.resolve(__dirname, '../src/')
}
</code></pre></div><p>alias就是起别名，当我们使用 <code>import abc from '@src/list'</code>  这样的语法时，alias会帮助我们自动将@src替换为 ../src/</p> <h4 id="_5、使用dllplugin提高打包速度"><a href="#_5、使用dllplugin提高打包速度" class="header-anchor">#</a> 5、使用DllPlugin提高打包速度</h4> <p>第三方模块代码不会变，不需要每次都打包。第一次打包的时候，可以作分析，下一次打包就根据分析，不作打包。这样就可以提高打包速度了。我们可以对第三方模块进行单独打包，生成dll文件。然后使用插件将dll文件注入开发模式或者生产模式打包后的html文件里面。</p> <h5 id="实现思路"><a href="#实现思路" class="header-anchor">#</a> 实现思路</h5> <ul><li>1、第三方模块单独打包，放在dll.js里面</li> <li>2、我们引入第三方模块的时候，要去使用dll文件里面的内容。可以使用DllPlugin插件，这样使用import引入第三方模块的时候，就不会去node_modules里面查找了，而是直接使用dll.js文件</li></ul> <h5 id="具体实现步骤"><a href="#具体实现步骤" class="header-anchor">#</a> 具体实现步骤</h5> <p>1、新建一个webpack.dll.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token comment">// 生产模式</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'react-dom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 把三方库写在这里</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        library<span class="token operator">:</span> <span class="token string">'[name]'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 使用dllPlugin，生成库的分析文件</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>  <span class="token comment">// 对库文件进行分析，name和library一样</span>
            path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/[name].manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// 把库和模块的映射关系放在manifest.json文件里面</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>把库和模块的映射关系放在manifest.json文件里面。</p> <p>2、 修改package.json</p> <div class="language-json extra-class"><pre class="language-json"><code> <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dll&quot;</span><span class="token operator">:</span><span class="token string">&quot;webpack  --config ./build/webpack.dll.js&quot;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>运行npm run dll，这样在根目录下就会生成dll目录，并且包含vendors.dll.js文件和manifest.json文件。这样就对第三方模块单独打包了。</p> <p>3、 使用插件将vendors.dll.js文件注入到开发模式或者生产模式打包后的html文件里面</p> <p>安装插件：<code>npm i add-asset-html-webpack-plugin -S</code></p> <p>修改webpack.dev.js:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> addAssetHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 引入这个插件</span>

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 把dll.js注入到html里面</span>
    <span class="token keyword">new</span> <span class="token class-name">addAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        filepath<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/vendors.dll.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 将映射关系注入到这里</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        manifest<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/vendors.manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>使用 webpack.DllReferencePlugin 插件，这样当我们使用import引入第三方模块的时候，就不会去 node_modules 里面查找了，而是直接根据 vendors.manifest.json文件去vendors.dll.js找对应的第三方模块，避免从 node_module里面找。</p> <h5 id="多个dll和manifest-json的情况"><a href="#多个dll和manifest-json的情况" class="header-anchor">#</a> 多个dll和manifest.json的情况</h5> <p>需要动态读取dll目录里面的内容</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.dev.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> addAssetHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 常用的插件</span>
<span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token operator">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 当任何一个模块中用了$,就自动加载juqery模块，并导入命名为$   </span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        $<span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
        _<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
        _join<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'loadsh'</span><span class="token punctuation">,</span> <span class="token string">'join'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token comment">// 动态读取dll目录里面的内容</span>
<span class="token keyword">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
files<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.*\.dll\.js/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">addAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            filepath<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.*\.manifest\.json/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            manifest<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>export<span class="token operator">=</span><span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> plugins  <span class="token comment">// plugins</span>
<span class="token punctuation">}</span>


</code></pre></div><h4 id="_6、控制包文件大小"><a href="#_6、控制包文件大小" class="header-anchor">#</a> 6、控制包文件大小</h4> <h4 id="_7、thread-loader，parallel-webpack，happypack多进程打包"><a href="#_7、thread-loader，parallel-webpack，happypack多进程打包" class="header-anchor">#</a> 7、thread-loader，parallel-webpack，happypack多进程打包</h4> <h4 id="_8、合理使用sourcemap"><a href="#_8、合理使用sourcemap" class="header-anchor">#</a> 8、合理使用sourceMap</h4> <h4 id="_9、结合stats分析打包结果"><a href="#_9、结合stats分析打包结果" class="header-anchor">#</a> 9、结合stats分析打包结果</h4> <h4 id="_10、开发环境内存编译"><a href="#_10、开发环境内存编译" class="header-anchor">#</a> 10、开发环境内存编译</h4> <h4 id="_11、开发环境无用插件剔除"><a href="#_11、开发环境无用插件剔除" class="header-anchor">#</a> 11、开发环境无用插件剔除</h4> <h2 id="十七、多页面打包配置"><a href="#十七、多页面打包配置" class="header-anchor">#</a> 十七、多页面打包配置</h2> <p>一个entry入口对应一个html文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.dev.js</span>
entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> <span class="token comment">// 第一个入口文件</span>
    list<span class="token operator">:</span><span class="token string">'./src/list.js'</span>  <span class="token comment">// 第二个入口文件</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>


<span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment">// 多页面打包配置</span>
    <span class="token comment">// 第一个页面</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token operator">:</span> <span class="token string">'src/index.html'</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token comment">// 取名为index.html</span>
        chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vendors'</span><span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">]</span>  <span class="token comment">// 配置需要的chunk</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 第二个页面</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token operator">:</span> <span class="token string">'src/index.html'</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'list.html'</span><span class="token punctuation">,</span> <span class="token comment">// 取名为list.html</span>
        chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vendors'</span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">]</span>  <span class="token comment">// 配置需要的chunk</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 当任何一个模块中用了$,就自动加载juqery模块，并导入命名为$   </span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        $<span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
        _<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
        _join<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'loadsh'</span><span class="token punctuation">,</span> <span class="token string">'join'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><p>如果需要动态读取entry的内容添加多个HtmlWebpackPlugin，则作以下配置，
注意需要安装html-webpack-plugin@next，因为公用的vendors不会被打包到两个页面里面</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.dev.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.prod.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> addAssetHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 常用的插件</span>
<span class="token keyword">const</span> <span class="token function-variable function">makePlugins</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 基础plugins</span>
    <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 当任何一个模块中用了$,就自动加载juqery模块，并导入命名为$   </span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            $<span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
            _<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            _join<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'loadsh'</span><span class="token punctuation">,</span> <span class="token string">'join'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 动态读取entry来自动添加htmlWebpackPlugins</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                template<span class="token operator">:</span> <span class="token string">'src/index.html'</span><span class="token punctuation">,</span>
                filename<span class="token operator">:</span> item <span class="token operator">+</span> <span class="token string">'.html'</span><span class="token punctuation">,</span>
                chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vendors'</span><span class="token punctuation">,</span> item<span class="token punctuation">]</span>  
    <span class="token comment">// 配置需要的chunk，注意需要安装html-webpack-plugin@next，不然vendors不会打包到页面里</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 动态读取dll目录里面的内容，添加addAssetHtmlWebpackPlugin和DllReferencePlugin</span>
    <span class="token keyword">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    files<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.*\.dll\.js/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">addAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                filepath<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.*\.manifest\.json/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                manifest<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> plugins<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//entry: './src/index.js', // 入口文件，等价于下面的main</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> <span class="token comment">// 第一个入口文件</span>
        list<span class="token operator">:</span> <span class="token string">'./src/list.js'</span>  <span class="token comment">// 第二个入口文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
        extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        mainFiles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        alias<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'@src'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    performance<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// 打包出口</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
        <span class="token comment">//publicPath: '/',  // webpackDevServer要配置这个</span>
        <span class="token comment">// publicPath: 'http://cdn.com/',  // 在打包后生成的js地址前面加上域名，即http://cdn.com/main.js</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span> <span class="token comment">// 打包后的目录,必须使用绝对路径,要用到path.resolve</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 配置相关loader</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|jpeg)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// loader: 'file-loader',  // 使用 file-loader 打包</span>
                    <span class="token comment">// options: {</span>
                    <span class="token comment">//     name: '[name].[ext]',// 配置打包后图片的名字,[name]就是图片的原名字,[ext]是原后缀</span>
                    <span class="token comment">//     outputPath: 'images/',  // 将打包后的图片放在images目录下，不配置则会放在根目录下</span>
                    <span class="token comment">// }</span>
                    loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span> <span class="token comment">// 使用 url-loader 打包，在文件大小（单位 byte）低于指定的限制时，可以返回一个 DataURL。</span>
                    options<span class="token operator">:</span> <span class="token punctuation">{</span>
                        name<span class="token operator">:</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span><span class="token comment">// 配置打包后图片的名字,[name]就是图片的原名字,[ext]是原后缀</span>
                        outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>  <span class="token comment">// 将打包后的图片放在images目录下，不配置则会放在根目录下</span>
                        limit<span class="token operator">:</span> <span class="token number">2048</span>  <span class="token comment">// 图片小于2048字节就会打包成base64</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(eot|ttf|svg)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">{</span>
                    loader<span class="token operator">:</span> <span class="token string">'file-loader'</span>  <span class="token comment">// 使用 file-loader 打包</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.jsx?$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
                <span class="token comment">// use: [&quot;babel-loader&quot;, {</span>
                <span class="token comment">//     loader: &quot;eslint-loader&quot;,</span>
                <span class="token comment">//     options: {</span>
                <span class="token comment">//         fix: true</span>
                <span class="token comment">//     }</span>
                <span class="token comment">// }]</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 开发业务代码时的写法</span>
                    <span class="token comment">//presets: [&quot;@babel/preset-env&quot;]</span>
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                        targets<span class="token operator">:</span> <span class="token punctuation">{</span>
                            edge<span class="token operator">:</span> <span class="token string">&quot;17&quot;</span><span class="token punctuation">,</span>
                            firefox<span class="token operator">:</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">,</span>
                            chrome<span class="token operator">:</span> <span class="token string">&quot;67&quot;</span><span class="token punctuation">,</span>
                            safari<span class="token operator">:</span> <span class="token string">&quot;11.1&quot;</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
                        corejs<span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 声明corejs版本</span>
                    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
                    <span class="token comment">// 开发第三方模块时的写法</span>
                    <span class="token comment">/*
                    &quot;plugins&quot;: [
                        [
                            &quot;@babel/plugin-transform-runtime&quot;,
                            {
                                &quot;absoluteRuntime&quot;: false,
                                &quot;corejs&quot;: 2,
                                &quot;helpers&quot;: true,
                                &quot;regenerator&quot;: true,
                                &quot;useESModules&quot;: false
                            }
                        ]
                    ]
                    */</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.ts$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token string">&quot;ts-loader&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//tree shaking 配置</span>
        usedExports<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 开发模式下需要配置，生产模式不需要，默认会tree shaking</span>
        <span class="token comment">// Code Splitting配置</span>
        splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// chunks: 'all',</span>
            <span class="token comment">// cacheGroups: {</span>
            <span class="token comment">//     vendors: false,</span>
            <span class="token comment">//     default: false</span>
            <span class="token comment">// }</span>
            chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// async，只对异步代码进行code spliting，all就是同步异步都分割</span>
            minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 代码分割最小的文件大小</span>
            minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 至少有1个chunk引用了这个模块，才会code Spliting</span>
            maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
            maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// vendors</span>
                vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
                    test<span class="token operator">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>  <span class="token comment">// 代码必须在node_module里面才会分到这个vendors组</span>
                    priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>  <span class="token comment">// 打包的权重，会选择priority大的打包</span>
                    <span class="token comment">//filename: &quot;vendors.js&quot;  // 仅对同步引入的模块生效,修改文件名</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
                    reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果一个模块被打包过了，则直接复用，不再做打包</span>
                    <span class="token comment">//filename: &quot;common.js&quot; // 仅对同步引入的模块生效,修改文件名</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
commonConfig<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token function">makePlugins</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果是线上环境</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>env <span class="token operator">&amp;&amp;</span> env<span class="token punctuation">.</span>production<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/11/2020, 3:29:56 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/interview/webpack/1.html" class="prev">
        核心概念
      </a></span> <span class="next"><a href="/blog/interview/webpack/3.html">
        底层原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.bce4cc53.js" defer></script><script src="/blog/assets/js/2.a9ec72d1.js" defer></script><script src="/blog/assets/js/86.a94b2c44.js" defer></script>
  </body>
</html>
